<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La VoÃ»te d'AnaÃ¯s â€” Editor</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¦‡</text></svg>">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="app-container">

        <header class="top-nav">
            <div>
                <h1 class="brand-title">La VoÃ»te <span class="brand-accent">d'AnaÃ¯s</span></h1>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 2px;">
                    <span class="brand-sub" style="margin-top:0">Pipeline Literario Â· 7 Agentes</span>
                    <select id="chapter-select" class="dropdown">
                        <option value="1">CapÃ­tulo 1</option>
                        <option value="2">CapÃ­tulo 2</option>
                        <option value="3">CapÃ­tulo 3</option>
                        <option value="4">CapÃ­tulo 4</option>
                        <option value="5">CapÃ­tulo 5</option>
                    </select>
                </div>
            </div>
            <div class="header-actions">
                <button id="btn-load" class="icon-btn" title="Cargar sesiÃ³n guardada">ğŸ“‚</button>
                <button id="btn-chat" class="icon-btn" title="El Confesor â€” Chat de preferencias">ğŸ•¯ï¸</button>
            </div>
            <div class="progress-tracker">
                <span class="step active" id="step-0">Premisa</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-1">Arco</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-2">Personajes</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-3">Escritura</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-4">CrÃ­tica</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-5">EdiciÃ³n</span>
                <span class="step-divider">â€º</span>
                <span class="step" id="step-6">MÃ©tricas</span>
            </div>
        </header>

        <main class="workspace">
            <aside class="agent-panel">
                <div class="agent-card active" id="card-0">
                    <div class="agent-icon">ğŸ§ </div>
                    <div class="agent-info">
                        <h3>El Ideador</h3>
                        <span class="model-tag">dolphin-mistral:7b ğŸ”“</span>
                        <small>SIN CENSURA â€” Desarrolla la premisa y define fetiches.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-1">
                    <div class="agent-icon">ğŸ“</div>
                    <div class="agent-info">
                        <h3>El Arquitecto</h3>
                        <span class="model-tag">qwen2.5:7b</span>
                        <small>Estructura el arco argumental y el clÃ­max.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-2">
                    <div class="agent-icon">ğŸ­</div>
                    <div class="agent-info">
                        <h3>Los Personajes</h3>
                        <span class="model-tag">dolphin-phi:2.7b ğŸ”“</span>
                        <small>SIN CENSURA â€” Fichas con fetiches y transformaciÃ³n.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-3">
                    <div class="agent-icon">âœï¸</div>
                    <div class="agent-info">
                        <h3>El Escritor</h3>
                        <span class="model-tag">dolphin-llama3:8b ğŸ”“</span>
                        <small>SIN CENSURA â€” Prosa erÃ³tica explÃ­cita. MÃ­n 3000 palabras.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-4">
                    <div class="agent-icon">ğŸ”</div>
                    <div class="agent-info">
                        <h3>El CrÃ­tico</h3>
                        <span class="model-tag">qwen2.5:7b</span>
                        <small>EvalÃºa tensiÃ³n, ritmo y sensorialidad.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-5">
                    <div class="agent-icon">âœ‚ï¸</div>
                    <div class="agent-info">
                        <h3>El Editor</h3>
                        <span class="model-tag">dolphin-llama3:8b ğŸ”“</span>
                        <small>SIN CENSURA â€” Reescritura explÃ­cita manteniendo la voz.</small>
                    </div>
                </div>
                <div class="agent-card" id="card-6">
                    <div class="agent-icon">ğŸ“Š</div>
                    <div class="agent-info">
                        <h3>El Contador</h3>
                        <span class="model-tag">llama3.2:3b</span>
                        <small>Verifica extensiÃ³n y formato final.</small>
                    </div>
                </div>
            </aside>

            <section class="editor-area">
                <div class="input-section">
                    <label for="user-prompt" id="prompt-label">Tu premisa oscura</label>
                    <textarea id="user-prompt"
                        placeholder="Una mujer descubre que su espejo inteligente le estÃ¡ robando su vocabulario y reduciendo sus pensamientos a estÃ­mulos sexuales cada vez que se desnuda frente a Ã©l..."></textarea>
                </div>

                <div class="action-bar">
                    <div class="streaming-indicator hidden" id="stream-status">
                        <div class="streaming-dot"></div>
                        <span id="stream-agent-name">El Ideador estÃ¡ escribiendo...</span>
                        <span class="token-counter" id="token-count">0 tokens</span>
                    </div>
                    <button id="btn-stop" class="danger-btn hidden">â–  Detener</button>
                    <button id="btn-generate" class="primary-btn">
                        <span class="btn-text">Invocar al Ideador</span>
                        <div class="loader hidden"></div>
                    </button>
                </div>

                <div class="output-section">
                    <label>Respuesta del agente <small>(editable)</small></label>
                    <textarea id="agent-output"
                        placeholder="El texto del agente aparecerÃ¡ aquÃ­, token por token, mientras piensa. Puedes editarlo antes de aprobarlo."></textarea>
                </div>

                <div class="checkpoint-actions hidden" id="checkpoint-controls">
                    <button id="btn-export" class="icon-btn" title="Exportar a HTML" style="margin-right:auto">ğŸ“„
                        HTML</button>
                    <button id="btn-feedback" class="feedback-btn" title="EnseÃ±ar al sistema">ğŸ§  Feedback</button>
                    <button id="btn-save" class="save-btn">ğŸ’¾ Guardar</button>
                    <button id="btn-reject" class="danger-btn">â†» Re-generar</button>
                    <button id="btn-approve" class="success-btn">Aprobar & Continuar â†’</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: Feedback -->
    <div class="modal-overlay hidden" id="feedback-modal">
        <div class="modal">
            <h3>ğŸ§  EnseÃ±ar al Sistema</h3>
            <p class="modal-sub">Este feedback se guarda en <code>preferencias_escritura.md</code> y se inyecta en
                futuros agentes.</p>
            <div class="feedback-type-selector">
                <button class="fb-type active" data-type="like">ğŸ‘ Me gusta</button>
                <button class="fb-type" data-type="dislike">ğŸ‘ No me gusta</button>
                <button class="fb-type" data-type="nota">ğŸ“ Nota</button>
            </div>
            <textarea id="feedback-comment"
                placeholder="Ej: 'MÃ¡s modismos chilenos', 'La transiciÃ³n fue muy rÃ¡pida', 'Este nivel de detalle sensorial es perfecto'..."></textarea>
            <div class="modal-actions">
                <button id="fb-cancel" class="danger-btn">Cancelar</button>
                <button id="fb-submit" class="success-btn">Guardar Aprendizaje</button>
            </div>
        </div>
    </div>

    <!-- Modal: Load Session -->
    <div class="modal-overlay hidden" id="load-modal">
        <div class="modal">
            <h3>ğŸ“‚ Cargar SesiÃ³n Guardada</h3>
            <div id="saved-sessions-list" class="sessions-list">
                <p class="modal-sub">Cargando sesiones...</p>
            </div>
            <div class="modal-actions">
                <button id="load-cancel" class="danger-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Chat Drawer: El Confesor -->
    <div class="chat-drawer hidden" id="chat-drawer">
        <div class="chat-header">
            <span>ğŸ•¯ï¸ El Confesor</span>
            <button id="chat-close" class="icon-btn" style="font-size:0.8rem">âœ•</button>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-bar">
            <textarea id="chat-input" placeholder="Â¿QuÃ© te gustÃ³ o quÃ© fallÃ³? Conversemos..." rows="2"></textarea>
            <button id="chat-send" class="primary-btn" style="padding:0.4rem 0.8rem">â†’</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>